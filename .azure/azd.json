{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "version": "0.1.0-alpha",
  "name": "simple-l7-proxy",
  "description": "SimpleL7Proxy is a layer 7 proxy service that supports prioritization, retries, and timeouts",
  "resources": {
    "simpleL7Proxy": {
      "type": "application",
      "properties": {
        "language": "dotnet",
        "host": "containerapp",
        "services": {}
      }
    }
  },
  "parameters": {
    "environmentName": {
      "type": "string",
      "defaultValue": "dev",
      "metadata": {
        "description": "Environment name (dev, test, prod)"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "westus2",
      "metadata": {
        "description": "Azure region for the deployment"
      }
    },
    "containerAppMinReplicas": {
      "type": "int",
      "defaultValue": 1,
      "metadata": {
        "description": "Minimum number of Container App replicas"
      }
    },
    "containerAppMaxReplicas": {
      "type": "int",
      "defaultValue": 5,
      "metadata": {
        "description": "Maximum number of Container App replicas"
      }
    },
    "useVNET": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Flag to determine if VNET should be used"
      }
    },
    "vnetAddressPrefix": {
      "type": "string",
      "defaultValue": "10.0.0.0/16",
      "metadata": {
        "description": "VNET address space"
      }
    },
    "subnetAddressPrefix": {
      "type": "string",
      "defaultValue": "10.0.0.0/21",
      "metadata": {
        "description": "Subnet address space"
      }
    },
    "enableAuthentication": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Flag to enable authentication"
      }
    },
    "authType": {
      "type": "string",
      "defaultValue": "none",
      "allowedValues": ["entraID", "servicebus", "none"],
      "metadata": {
        "description": "Authentication type"
      }
    },
    "useAsyncStorage": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Flag to enable async storage features"
      }
    },
    "backendHostURLs": {
      "type": "string",
      "metadata": {
        "description": "Comma-separated list of backend URLs"
      }
    },
    "defaultRequestTimeout": {
      "type": "int",
      "defaultValue": 100000,
      "metadata": {
        "description": "Default timeout for requests in milliseconds"
      }
    },
    "enableAppInsights": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Flag to enable Application Insights"
      }
    },
    "queuePriorityLevels": {
      "type": "int",
      "defaultValue": 3,
      "metadata": {
        "description": "Number of priority levels to configure"
      }
    },
    "enableScaleRule": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable auto-scaling based on HTTP concurrent requests"
      }
    },
    "httpConcurrentRequestsThreshold": {
      "type": "int",
      "defaultValue": 10,
      "metadata": {
        "description": "Number of concurrent requests that trigger scaling"
      }
    }
  }
}