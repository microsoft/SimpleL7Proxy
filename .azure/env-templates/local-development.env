# Local Development Environment Template
# Configured for running SimpleL7Proxy locally with "dotnet run"
# Based on deployment/env copy.sh - optimized for local development and testing

# === Core Proxy Settings ===
# Reduced worker count for local development
Workers=5
# Large queue for local testing scenarios
MaxQueueLength=40000
# Shorter timeout for quick local feedback (100 seconds)
Timeout=100000
# Standard polling for local development
PollInterval=15000
PollTimeout=3000
# Local development port
Port=8000

# === Priority & Queue Management ===
# Simple priority system for local testing
DefaultPriority=2
PriorityKeyHeader=S7PPriorityKey
PriorityKeys=test,normal
PriorityValues=1,2
# Simple worker allocation for local testing
PriorityWorkers=1:2,2:3

# === Backend Configuration ===
# Local backend hosts for development testing
LoadBalanceMode=roundrobin
# Local development backends (adjust ports as needed)
Host1=http://localhost:3000
Host2=http://localhost:3000
Probe_path1=/health
Probe_path2=/health

# === Connection Settings ===
# Standard connection settings for local development
KeepAliveInitialDelaySecs=60
KeepAlivePingIntervalSecs=60
KeepAliveIdleTimeoutSecs=600
# Disable multiple connections for local simplicity
EnableMultipleHttp2Connections=false

# === Circuit Breaker (Lenient for local testing) ===
CBErrorThreshold=80
CBTimeslice=120
SuccessRate=60

# === Async Operations (Enabled with real Azure resources) ===
AsyncModeEnabled=true
# Very fast trigger timeout for local testing
AsyncTriggerTimeout=1
# Configure these with your actual Azure resources:
# AsyncSBUseMI=true
# AsyncSBNamespace=your-servicebus-namespace.servicebus.windows.net
# AsyncBlobStorageUseMI=true
# AsyncBlobStorageAccountUri=https://your-storage-account.blob.core.windows.net/
# AsyncSBQueue=rstatus

# === Storage & Database ===
StorageDbEnabled=false

# === Authentication (Disabled for local testing) ===
UseOAuth=false
UseOAuthGov=false
ValidateAuthAppID=false
UseProfiles=true

# === Logging (Local file logging) ===
# Local development logging configuration
LogConsole=true
LogConsoleEvent=false
LogAllRequestHeaders=false
LogAllResponseHeaders=true
LogPoller=false
LogProbes=false
# Specific headers for local testing
LogHeaders=Random-Header,x-Random-Header

# === Header Management (Local testing headers) ===
# Local development header configuration
RequiredHeaders=test
DisallowedHeaders=gg
StripResponseHeaders=
ValidateHeaders=xx:Header1
TimeoutHeader=S7PTimeout
TTLHeader=S7PTTL
UniqueUserHeaders=X-UserProfile
ValidateAuthAppIDHeader=Auth

# === Dependency Headers ===
DependancyHeaders=Backend-Host, Host-URL, Status, Duration, Error, Message, Request-Date, backendLog, x-PolicyCycleCounter

# === Response Settings ===
AcceptableStatusCodes=200,202,401,403,404,408,410,412,417,400,500,502,503,504
DefaultTTLSecs=120

# === User Management ===
UserIDFieldName=userId
UserPriorityThreshold=0.5

# === Container Settings ===
RequestIDPrefix=S7P-LOCAL

# === Local Development Specific ===
# Enable file logging for local development
# LOGTOFILE=true (if supported)

# === Application Insights (Configure with your connection string) ===
# APPINSIGHTS_CONNECTIONSTRING=InstrumentationKey=your-key;IngestionEndpoint=https://your-region.in.applicationinsights.azure.com/