properties:
  environmentId: /subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RG/providers/Microsoft.App/managedEnvironments/YOUR_ENV_NAME
  configuration:
    ingress:
      external: true
      targetPort: 443
      transport: http
      traffic:
        - latestRevision: true
          weight: 100
    registries:
      # Update with your ACR details
      - server: YOUR_ACR_NAME.azurecr.io
        identity: system
  template:
    containers:
      # Main application container (includes built-in ProbeServer on port 9000)
      - name: simplel7proxy
        image: YOUR_ACR_NAME.azurecr.io/simplel7proxy:latest
        resources:
          cpu: 1.0
          memory: 2Gi
        env:
          # Add your environment variables here
          - name: ASPNETCORE_ENVIRONMENT
            value: Production
        # Main app listens on port 443
        # ProbeServer runs as BackgroundService on port 9000
        probes:
          - type: Liveness
            httpGet:
              path: /liveness
              port: 9000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 3
            successThreshold: 1
            failureThreshold: 3
          - type: Readiness
            httpGet:
              path: /readiness
              port: 9000
              scheme: HTTP
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 3
            successThreshold: 1
            failureThreshold: 3
          - type: Startup
            httpGet:
              path: /startup
              port: 9000
              scheme: HTTP
            initialDelaySeconds: 0
            periodSeconds: 5
            timeoutSeconds: 3
            successThreshold: 1
            failureThreshold: 30
    scale:
      minReplicas: 1
      maxReplicas: 10
      rules:
        - name: http-scaling
          http:
            metadata:
              concurrentRequests: "100"
